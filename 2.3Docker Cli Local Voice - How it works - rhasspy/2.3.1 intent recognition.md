# intent recognition

home_assistant_conversation

does intent recognition on a home assistant server.

After your voice command has been transcribed by the speech to text system, this step is to recognize your intent. 

The end result is a JSON event with information about the intent.

Inputs text
Outputs an intent with a name and entities (slots)

意图识别（Intent Recognition）是自然语言处理（NLP）中的一个重要任务，它旨在确定用户输入的语句中所表达的意图或目的。简单来说，意图识别就是对用户的话语进行语义理解.

数据以json格式给出，每条数据包括三个关键词：text表示待检测的文本，intent代表文本的类别标签，slots是文本中包括的所有槽位以及对应的槽值，以字典形式给出。
~~~
{

"text": "搜索西红柿的做法。",

"domain": "cookbook",

"intent": "QUERY",

"slots": {"ingredient": "西红柿"}

}
~~~

## How it works

Home Assistant's intent recognition is powered by hassil. Hassil recognizes intents by matching the user input against sentence templates.

A sentence template is a sentence that contains slots, placeholders for data, and supports various syntax to allow a single template match a wide range of similar sentences.

(turn | switch) on [the] {area} lights

This example sentence template matches both turn on kitchen lights and switch on the kitchen lights. In both cases it will extract extra data area set to kitchen.

sourece:https://developers.home-assistant.io/docs/voice/intent-recognition/

offcial sentence template
https://github.com/home-assistant/intents/blob/main/sentences/en/light_HassTurnOn.yaml


- Setting up custom sentences in configuration.yaml
https://www.home-assistant.io/voice_control/custom_sentences_yaml/

~~~
# Example configuration.yaml
conversation:
  intents:
    HassTurnOn:
      - "activate [the] {name}"
~~~

- Adding a custom sentence in config directory
https://www.home-assistant.io/voice_control/custom_sentences

https://www.home-assistant.io/integrations/conversation/#adding-custom-sentences

~~~
# config/custom_sentences/en/temperature.yaml
# Example temperature.yaml entry
language: "en"
intents:
  CustomOutsideHumidity:
    data:
      - sentences:
          - "What is the humidity outside"
~~~





## Assist is very slow

Assist is very slow when I input sentences that don't match an intent (e.g. the STT didn't transcribe correctly or I spoke an incorrect command). I

There are 3 stages to intent matching, each slower than the last.
In stage 1, intents are matched strictly against the exposed entities list. This is usually quick because there are far fewer exposed entities.
If stage 1 fails, stage 2 attempts to match strictly against all entities in HA. This is so we can understand if you're trying to do something with an entity that isn't exposed.
If stage 2 fails, stage 3 runs the intent matcher in a fuzzy mode. This allows it to parse sentences like "turn on blah in the kitchen" as a HassTurnOn intent with name=blah (not a real entity) and area=kitchen (real area). With this information, we can provide a useful error message like "No device named blah".


events generated by intent




They appear in the debug log:

~~~
  - type: intent-start
    data:
      engine: conversation.home_assistant
      language: zh-cn
      intent_input: 真
      conversation_id: null
      device_id: 9f17f2d8eef5800dea7865a8eea2c855
      prefer_local_intents: true
    timestamp: "2025-03-01T09:29:50.911911+00:00"
  - type: intent-end
    data:
      processed_locally: true
      intent_output:
        response:
          speech:
            plain:
              speech: 抱歉，我无法理解您的意思，你可以尝试换个说法
              extra_data: null
          card: {}
          language: zh-cn
          response_type: error
          data:
            code: no_intent_match
        conversation_id: 01JN8GMSJ6H94S2CGJ92Q30G16
    timestamp: "2025-03-01T09:29:54.037113+00:00"

~~~


~~~
events:
  - type: run-start
    data:
      pipeline: 01h0amejr3nf5059gavrx5jm7g
      language: en
      runner_data:
        stt_binary_handler_id: null
        timeout: 300
    timestamp: "2025-02-01T21:00:20.647661+00:00"
  - type: intent-start
    data:
      engine: conversation.home_assistant
      language: en
      intent_input: Babble Babble
      conversation_id: null
      device_id: null
      prefer_local_intents: false
    timestamp: "2025-02-01T21:00:20.647697+00:00"
  - type: intent-end
    data:
      processed_locally: true
      intent_output:
        response:
          speech:
            plain:
              speech: Sorry, I couldn't understand that
              extra_data: null
          card: {}
          language: en
          response_type: error
          data:
            code: no_intent_match
        conversation_id: null
    timestamp: "2025-02-01T21:00:20.693508+00:00"
  - type: run-end
    data: null
    timestamp: "2025-02-01T21:00:20.693566+00:00"

~~~

https://community.home-assistant.io/t/can-we-make-use-of-events-generated-by-intent-errors/840011